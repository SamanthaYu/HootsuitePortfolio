<HTML>
	<HEAD>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<TITLE>Samantha Yu: Dogwood</TITLE>
		<link rel="stylesheet" type="text/css" href="../CSS/dogwoodStyle.css">
		<link href='http://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>
		
		<script type="text/javascript" src="http://ajblk.github.io/SyntaxHighlightGenerator-v3.0/scripts/sh-v3.0-min.js"></script>
		<!-- Same stylesheet as http://ajblk.github.io/SyntaxHighlightGenerator-v3.0/styles/shCoreDefault.css but with different colors and without the vertical scrollbar on the side -->
		<link type="text/css" rel="stylesheet" href="../CSS/abjlkSyntaxHighlighter.css"/>
	<HEAD>
	<BODY>
		<div id="banner">
			<div id="bannerTitle"><a href="../index.html" id="indexBanner">
				<div id="bannerName">
					<h1> Samantha Yu </h1>
				</div>
				<div id="bannerDogwood">
					<h2> Dogwood Portfolio </h2>
				</div>
			</a></div>
			<div class="verticalLine" id="boldLine"></div>
			<div class="verticalLine" id="regLine"></div>
			<div id="bannerMenu">
				<div class="menuButton"><a href="about.html" class="headingLink"><h3> About </h3></a></div>
				<div class="menuButton selectedMenu"><a href="paint.html" class="headingLink"><h3> Paint </h3></a></div>
				<div class="menuButton"><a href="blackjack.html" class="headingLink"><h3> Blackjack </h3></a></div>
			</div>
		</div>
		<div id="container">
			<div class="bodyContent" id="mainBody">
				<h5> Double Buffering </h5> <hr>
				<p> The process of directly painting an image to the screen, completely erasing that image, and painting a new image to the screen causes flickering.
					<a href="https://docs.oracle.com/javase/tutorial/extra/fullscreen/doublebuf.html" target="_blank"> Double buffering </a> avoids this flickering by creating an off-screen image that is later transferred to the screen.
				</p> <br>
				<p>
					When the user draws on the canvas, <span class="method">useTool()</span> grabs the current off-screen layer and creates a <span class="class">Graphics2D</span> context associated with that layer.
					The paint tools draw onto the <span class="class">Graphics2D</span> <span class="var">cgBuffer</span> and stores those changes in <span class="class">BufferedImage</span> <span class="var">cvMem</span>.
				</p>
				
				<div id="highlighterMainDiv_253698" class="syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><caption>Tools.java -- Painting onto off-screen image</caption><tbody><tr><td class="gutter"><div class="line number56 index0 alt1">56</div><div class="line number57 index1 alt2">57</div><div class="line number58 index2 alt1">58</div><div class="line number59 index3 alt2">59</div><div class="line number60 index4 alt1">60</div><div class="line number61 index5 alt2">61</div><div class="line number62 index6 alt1">62</div><div class="line number63 index7 alt2">63</div><div class="line number64 index8 alt1">64</div><div class="line number65 index9 alt2">65</div><div class="line number66 index10 alt1">66</div><div class="line number67 index11 alt2">67</div><div class="line number68 index12 alt1">68</div></td><td id="codeContainer_253698" class="code"><div id="container_253698" class="container"><div class="line number56 index0 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">useTool(</code><code class="java keyword">int</code> <code class="java plain">numTool, </code><code class="java keyword">int</code> <code class="java plain">oldX, </code><code class="java keyword">int</code> <code class="java plain">oldY, </code><code class="java keyword">int</code> <code class="java plain">newX, </code><code class="java keyword">int</code> <code class="java plain">newY) {&nbsp; </code><code class="java comments">// Selects specific tool</code></div><div class="line number57 index1 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cvMem = layersArray.getImageArray().get(layersArray.getcLayerNum());&nbsp;&nbsp;&nbsp; </code><code class="java comments">// Grabs the current layer</code></div><div class="line number58 index2 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cgBuffer = (Graphics2D) cvMem.getGraphics();&nbsp;&nbsp;&nbsp; </code><code class="java comments">// Creates the graphics context for that layer to be used in double buffering</code></div><div class="line number59 index3 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cgBuffer.setColor(menuBar.paintColor);</code></div><div class="line number60 index4 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number61 index5 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The y-coordinates are subtracted by the menu bar's height, because the canvas layers do not include the menu bar</code></div><div class="line number62 index6 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(numTool == </code><code class="java value">1</code><code class="java plain">)</code></div><div class="line number63 index7 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">pencil(oldX, oldY - paintLab.getMenuHeight(), newX, newY - paintLab.getMenuHeight());</code></div><div class="line number64 index8 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">else</code> <code class="java keyword">if</code> <code class="java plain">(numTool == </code><code class="java value">2</code><code class="java plain">)</code></div><div class="line number65 index9 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">brush(oldX, oldY - paintLab.getMenuHeight(), newX, newY - paintLab.getMenuHeight());</code></div><div class="line number66 index10 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">else</code> <code class="java keyword">if</code> <code class="java plain">(numTool == </code><code class="java value">3</code><code class="java plain">)</code></div><div class="line number67 index11 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">spray(newX, newY - paintLab.getMenuHeight());</code></div><div class="line number68 index12 alt1"><code class="java plain">}</code></div></div></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>

				<pre id="presourcecode_253698" class="displaysourcecode" >
				public void useTool(int numTool, int oldX, int oldY, int newX, int newY) {  // Selects specific tool
					cvMem = layersArray.getImageArray().get(layersArray.getcLayerNum());    // Grabs the current layer
					cgBuffer = (Graphics2D) cvMem.getGraphics();    // Creates the graphics context for that layer to be used in double buffering
					cgBuffer.setColor(menuBar.paintColor);
					
					// The y-coordinates are subtracted by the menu bar's height, because the canvas layers do not include the menu bar
					if (numTool == 1)
						pencil(oldX, oldY - paintLab.getMenuHeight(), newX, newY - paintLab.getMenuHeight());
					else if (numTool == 2)
						brush(oldX, oldY - paintLab.getMenuHeight(), newX, newY - paintLab.getMenuHeight());
					else if (numTool == 3)
						spray(newX, newY - paintLab.getMenuHeight());
				}
				</pre>

				<p>
					In my paint program, <span class="class">Graphics2D</span> <span class="var">g2Frame</span> paints the off-screen image stored in <span class="class">ArrayList&lt;BufferedImage&gt;</span> <span class="var">imageArray</span> at the index of <span class="class">int</span> <span class="var">cLayerNum</span> onto the screen.
					Instead of clearing the entire screen, <span class="method">update()</span> alters the display with only the changes made.
				</p>
				
				<div id="highlighterMainDiv_552798" class="syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><caption>PaintApp.java -- Updating the visible image with changes from off-screen image</caption><tbody><tr><td class="gutter"><div class="line number202 index0 alt1">202</div><div class="line number203 index1 alt2">203</div><div class="line number204 index2 alt1">204</div><div class="line number205 index3 alt2">205</div><div class="line number206 index4 alt1">206</div><div class="line number207 index5 alt2">207</div><div class="line number208 index6 alt1">208</div><div class="line number209 index7 alt2">209</div><div class="line number210 index8 alt1">210</div><div class="line number211 index9 alt2">211</div></td><td id="codeContainer_552798" class="code"><div id="container_552798" class="container"><div class="line number202 index0 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">update(Graphics g) {</code></div><div class="line number203 index1 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// When repaint() is called, the update() then calls paint()</code></div><div class="line number204 index2 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Since "default implementation of update() clears the Component's background before calling paint()", </code></div><div class="line number205 index3 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// (see <a href="http://journals.ecs.soton.ac.uk/java/tutorial/ui/drawing/update.html">http://journals.ecs.soton.ac.uk/java/tutorial/ui/drawing/update.html</a>)</code></div><div class="line number206 index4 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// I removed the background layers from flickering by drawing the layers here</code></div><div class="line number207 index5 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(</code><code class="java keyword">int</code> <code class="java plain">k = </code><code class="java value">0</code><code class="java plain">; k &lt; layersArray.getImageArray().size(); k++) {</code></div><div class="line number208 index6 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">g2Frame.drawImage(layersArray.getImageArray().get(k), </code><code class="java value">0</code><code class="java plain">, getMenuHeight(), </code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number209 index7 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number210 index8 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">paint(g);</code></div><div class="line number211 index9 alt2"><code class="java plain">}</code></div></div></td></tr><tr><td>&nbsp;</td></tr></tbody></table></div>
				<pre id="presourcecode_552798" class="displaysourcecode" >
				public void update(Graphics g) {
					// When repaint() is called, the update() then calls paint()
					// Since "default implementation of update() clears the Component's background before calling paint()", 
					// (see http://journals.ecs.soton.ac.uk/java/tutorial/ui/drawing/update.html)
					// I removed the background layers from flickering by drawing the layers here
					for (int k = 0; k &lt; layersArray.getImageArray().size(); k++) {
						g2Frame.drawImage(layersArray.getImageArray().get(k), 0, getMenuHeight(), this);
					}
					paint(g);
				}
				</pre>
			</div>
			<div class="bodyContent" id="sidebar">
				<h4><a href="about.html" class="submenuHeading"> About </a></h4>
				<br>
				<h4><a href="paint.html" class="submenuHeading"> Paint Program </a></h4>
				<ul class="ulMenu"><a href="paint_doubleBuffering.html" class="menuLinks selectedSubmenu"> Double Buffering </a></ul>
				<ul class="ulMenu"><a href="paint_startup.html" class="menuLinks"> On Startup </a></ul>
				<ul class="ulMenu"><a href="paint_layers.html" class="menuLinks"> Layers </a></ul>
				<ul class="ulMenu"><a href="paint_menu.html" class="menuLinks"> Menu </a></ul>
				<ul class="ulMenu"><a href="paint_colors.html" class="menuLinks"> Colors </a></ul>
				<ul class="ulMenu"><a href="paint_tools.html" class="menuLinks"> Tools </a></ul>
				<ul class="ulMenu"><a href="../Javadoc/javadoc_paintApp.html" class="menuLinks"> Javadoc</a></ul>
					<ul class="jdoc_ulMenu"><a href="../Javadoc/javadoc_paintApp.html" class="jdocLinks"> PaintApp Class </a></ul>
					<ul class="jdoc_ulMenu"><a href="../Javadoc/javadoc_layers.html" class="jdocLinks"> Layers Class </a></ul>
					<ul class="jdoc_ulMenu"><a href="../Javadoc/javadoc_menu.html" class="jdocLinks"> Menu Class </a></ul>
					<ul class="jdoc_ulMenu"><a href="../Javadoc/javadoc_tools.html" class="jdocLinks"> Tools Class </a></ul>
				<ul class="ulMenu"><a href="paint_source.html" class="menuLinks"> Source Code </a></ul>
				<br>
				<h4><a href="../HTML/blackjack.html" class="submenuHeading"> Blackjack </a></h4>
				<ul class="ulMenu"><a href="bj_gameplay.html" class="menuLinks"> Gameplay </a></ul>
				<ul class="ulMenu"><a href="bj_money.html" class="menuLinks"> Money </a></ul>
				<ul class="ulMenu"><a href="bj_source.html" class="menuLinks"> Source Code </a></ul>
			</div>
		</div>
	<script type="text/javascript">SyntaxHighlighter.initialize();</script>
	</BODY>
</HTML>